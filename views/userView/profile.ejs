<%- include('../layouts/userHeader.ejs') -%>


<div class="site-wrap">
    <div class="bg-light py-3">
        <div class="container">
          <div class="row">
            <div class="col-md-12 mb-0"><a href="/">Home</a> <span class="mx-2 mb-0">/</span> <strong class="text-black">Profile</strong></div>
          </div>
        </div>
      </div>
      <section style="background-color: #eee;">
        <div class="container py-5">
      
          <div class="row">
            <div class="col-lg-4">
              <div class="card mb-4">
                <div class="card-body text-center">
                  <h5 class="my-3"><%= user.name %></h5>
                  <p class="text-muted mb-1"><%= user.mobile %></p>
                  <p class="text-muted mb-4"><%= user.email %></p>
                  <div class="d-flex justify-content-center mb-2">
                    <a href="/logout" class="btn btn-primary me-2">Logout</a>
                    <button class="btn btn-primary" data-toggle="modal" data-target="#exampleModalLong">Add Address</button>
                  </div>
                </div>
              </div>


              <!-- Add address modal -->
              <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLongTitle">Add Your Address</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <div class="p-3 p-lg-5 border">
                        <form action="/addAddress" onsubmit="return validatAddressForm2()"  method="post">
          
                        <span id="form_error"></span>
                          <%
                              if(typeof message !== 'undefined'){
                                %>
                                <div id="msg" class="col-md-12 alter alert-danger">
                                  <p class="fw-semibold text-center"> <%= message %> </p>
                                </div>
                                <%
                              }
          
                            %>
          
                        <div class="form-group row">
                          <div class="col-md-12">
                            <label for="c_fname" class="text-black"> Name <span class="text-danger">*</span></label>
                            <input name="name"   type="text" class="form-control" id="name" onkeyup="validatString('name','name_error','Name')" required/><span id="name_error"></span>
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="country" class="text-black">Country <span class="text-danger">*</span></label>
                          <input name="country"  type="text" id="country" class="form-control" value="India" onkeyup="validatString('country','country_error','Country')"><span id="country_error"></span>
                        </div>
                        <div class="form-group">
                          <label for="state" class="text-black">State <span class="text-danger">*</span></label>
                          <input name="state"  type="text" id="state" class="form-control" onkeyup="validatString('state','state_error','State')" required><span id="state_error"></span>
                        </div>
          
                        <div class="form-group">
                          <label for="district" class="text-black">District<span class="text-danger">*</span></label>
                          <input name="district"  type="text" id="district" class="form-control" onkeyup="validatString('district','district_error','District')" required><span id="district_error"></span>
          
                        </div>
                        <div class="form-group">
                            <label for="streat" class="text-black">Street <span class="text-danger">*</span></label>
                            <input name="streat"  type="text" id="streat" class="form-control" onkeyup="validatString('streat','streat_error','Streat')" required><span id="streat_error"></span>
                          </div>
                        <div class="form-group row">
                          <div class="col-md-12 mb-3">
                            <label for="building" class="text-black">Building <span class="text-danger">*</span></label>
                            <input name="building"  type="text" class="form-control  py-5" id="building" onkeyup="validatString('building','building_error','Building')" required><span id="building_error"></span>
                          </div>
                        </div>
                        <div class="form-group">
                            <label for="landmark" class="text-black">Land Mark<span class="text-danger">*</span></label>
                            <input name="landmark"  type="text" id="landmark" class="form-control" onkeyup="validatString('landmark','landmark_error','Land Mark')" required><span id="landmark_error"></span>
            
                          </div>
                        <div class="form-group row">
                          <div class="col-md-12">
                            <label for="pincode" class="text-black">Pincode<span class="text-danger">*</span></label>
                            <input name="pincode" type="number" class="form-control" id="pincode" onkeyup="validatNum2('pincode','pincode_error','Pincode')" required><span id="pincode_error"></span>
                          </div>
                        </div>
          
                        <div class="form-group row mb-5">
                          <div class="col-md-12">
                            <label for="mobile" class="text-black">Mobile No. <span class="text-danger">*</span></label>
                            <input name="mobile" type="number" class="form-control" id="mobile" onkeyup="validatNum2('mobile','phone_error','Mobile')" required><span id="phone_error"></span>
                          </div>
                        </div>
                        <div class="modal-footer form-group">
                          <button type="submit" class="btn btn-primary" onclick="return validatAddressForm2()">Save</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              </div>
               <!-- /Add address modal -->

              <div class="card mb-4 mb-lg-0">
                <div class="card-body p-0">
                  <ul class="list-group list-group-flush rounded-3">
                    <a href="/wishlist" title="Wishlist">
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                            <i class="icon icon-heart-o fa-lg text-warning"></i>
                            <p class="mb-0">My Wishlist</p>
                          </li>
                    </a>

                    <a href="/cart" title="Cart">
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                            <i class="icon icon-shopping_cart" style="color: #873a3a;"></i>
                            <p class="mb-0">My Cart</p>
                          </li>
                    </a>

                    <a href="/order" title="Orders">
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                            <i class="fa-solid fa-bag-shopping" style="color: #55acee;"></i>
                            <p class="mb-0">My Orders</p>
                          </li>
                    </a>

                    <a href="/wallet">
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                            <i class="fa-solid fa-wallet" style="color: #ac2bac;"></i>
                            <p class="mb-0">My Wallet</p>
                          </li>
                    </a>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-lg-8">
              <div class="card mb-4">
                <div class="card-body">
                  <div class="row">
                    <div class="col-sm-3">
                      <ul class="list-group list-group-flush rounded-3">
                      <p class="mb-0">Name</p>
                    </div>
                    <div class="col-sm-9 d-flex justify-content-between">
                      <p class="text-muted mb-0"><%= user.name %></p>
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <p class="mb-0">Email</p>
                    </div>
                    <div class="col-sm-9 d-flex justify-content-between">
                      <p class="text-muted mb-0"><%= user.email %></p>
                      <!-- <a href=""><i class="fa-solid fa-user-pen fa-lg"></i></a> -->
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <p class="mb-0">Phone</p>
                    </div>
                    <div class="col-sm-9 d-flex justify-content-between">
                      <p class="text-muted mb-0"><%= user.mobile %></p>
                      <!-- <a href=""><i class="fa-solid fa-user-pen fa-lg"></i></a> -->
                    </div>
                  </div>
                  <hr>
                </div>
              </div>
              <div class="row body bg-white">
                <div class="col-md-12 mb-5 ">
                    <h2 class="h3 mb-3 text-black">My Address Details</h2>
                   
                    <div class="p-lg-5 border">
                    <% addressData?.address.forEach((address, index) => { %>
                      <div class="border p-3 mb-3">
                        <h3 class="h6 mb-0"><a class="d-block" data-toggle="collapse" href="#collapsebank" role="button" aria-expanded="false" aria-controls="collapsebank">Address - <%= index + 1 %> </a></h3>
                        
                        <div class="collapse" id="collapsebank">
                          <div class="py-2">
                            <p class="mb-0">
                                <%= address.name %>,
                                <%= address.mobile %>,
                                <%= address.state %>,
                                <%= address.district %>
                                <%= address.add %>,
                                <%= address.pincode %>
                            </p>
                          </div>
                        </div>
                        <div class="d-flex" >
                           <button type="submit" id="collapsebank"  data-toggle="modal" data-target="#exampleModalLong<%= address._id %>"  class="collapse btn btn-sm btn-primary me-3">Edit</button> 

                          <a href="/deleteAddress/<%= address._id %>" > 
                            <button  id="collapsebank"  address-id="<%= address._id %>" class="delete-address-btn collapse btn btn-sm btn-primary">Delete</button>
                          </a> 

                        </div>

                        <!-- Address Modal -->
                        <div class="modal fade" id="exampleModalLong<%= address._id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Edit Your Address</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                                <form action="/edit_address/<%= address._id %>" onsubmit="return validatAddressForm2()" class="edit-address-form" address-id="<%= address._id %>" method="post">
                              </div>
                              <div class="modal-body">
                                <div class="p-3 p-lg-5 border">
                                    <span id="form_error"></span>
                    
                                    <%
                                        if(typeof message !== 'undefined'){
                                          %>
                                          <div id="msg" class="col-md-12 alter alert-danger">
                                            <p class="fw-semibold text-center"> <%= message %> </p>
                                          </div>
                                          <%
                                        }
                    
                                      %>
                    
                                      <div class="form-group row">
                                        <div class="col-md-12">
                                          <label for="name" class="text-black"> Name <span class="text-danger">*</span></label>
                                          <input name="name"   type="text" class="form-control" id="name" value="<%= address.name %>" onkeyup="validatString('name','name_error','Name')" required/><span id="name_error"></span>
                                        </div>
                                      </div>
                                      <div class="form-group">
                                        <label for="country" class="text-black">Country <span class="text-danger">*</span></label>
                                        <input name="country"  type="text" id="country" class="form-control" value="<%= address.country %>" onkeyup="validatString('country','country_error','Country')"><span id="country_error"></span>
                                      </div>
                                      <div class="form-group">
                                        <label for="state" class="text-black">State <span class="text-danger">*</span></label>
                                        <input name="state"  type="text" id="state" class="form-control" value="<%= address.state %>" onkeyup="validatString('state','state_error','State')" required><span id="state_error"></span>
                                      </div>
                        
                                      <div class="form-group">
                                        <label for="district" class="text-black">District<span class="text-danger">*</span></label>
                                        <input name="district"  type="text" id="district" class="form-control" value="<%= address.district %>" onkeyup="validatString('district','district_error','District')" required><span id="district_error"></span>
                        
                                      </div>
                                      <div class="form-group">
                                          <label for="streat" class="text-black">Streat <span class="text-danger">*</span></label>
                                          <input name="streat"  type="text" id="streat" class="form-control" value="<%= address.streat %>" onkeyup="validatString('streat','streat_error','Streat')"  required><span id="streat_error"></span>
                                        </div>
                                      <div class="form-group row">
                                        <div class="col-md-12 mb-3">
                                          <label for="building" class="text-black">Building <span class="text-danger">*</span></label>
                                          <input name="building"  type="text" class="form-control  py-5" id="building" value="<%= address.building %>" onkeyup="validatString('building','building_error','Building')" required>
                                        </div><span id="building_error"></span>
                                      </div>
                                      <div class="form-group">
                                          <label for="landmark" class="text-black">Land Mark<span class="text-danger">*</span></label>
                                          <input name="landmark"  type="text" id="landmark" class="form-control" value="<%= address.landmark %>" onkeyup="validatString('landmark','landmark_error','Land Mark')" required><span id="landmark_error"></span>
                                        </div>
                                      <div class="form-group row">
                                        <div class="col-md-12">
                                          <label for="pincode" class="text-black">Pincode<span class="text-danger">*</span></label>
                                          <input name="pincode" type="text" class="form-control" id="pincode" value="<%= address.pincode %>" onkeyup="validatNm2('pincode','pincode_error','Pincode')" required><span id="pincode_error"></span>
                                        </div>
                                      </div>
                        
                                      <div class="form-group row mb-5">
                                        <div class="col-md-12">
                                          <label for="mobile" class="text-black">Mobile No. <span class="text-danger">*</span></label>
                                          <input name="mobile" type="text" class="form-control" id="mobile" value="<%= address.mobile %>" onkeyup="validatNum2('mobile','phone_error','Mobile')" required><span id="phone_error"></span>
                                        </div>
                                      </div>
                                </div>
                              </div>
                              <div class="modal-footer form-group">
                                <button type="submit" class="btn btn-primary" onclick="return validatAddressForm2()">Save changes</button>
                              </div>
                            </form>
                            </div>
                          </div>
                        </div>
                      </div>
                      <% }) %>
                    </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </section>
</div>

  
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<!-- <script>
  //edit address ajax
  $('form.edit-address-form').on('submit', function(e){
    e.preventDefault();

    var addressId = $(this).data('address-id');
    var formData = $(this).serialize();

    $.ajax({
      url: '/edit_address' + addressId,
      method: 'POST',
      data: formData,
      success: (response) =>{
        Toastify({
          Text: "response.data.message",
          duration: 4000,
          style:{backgroundColor: 'Green'},
          destination: '/user/profile',
          close: true,
        }).showToast();
      },

      error: ((error)=>{
        Toastify({
          Text: 'Error occured while updating Address!!',
          duration: 4000,
          backgroundColor: 'Red',
          destination: '/user/profile',
          close: true,
        }).showToast();
      })
    });
  });


  //delete address ajax
  $('.delete-address-btn').on('click', function(e){
    var addressId = $(this).data('address-id');

    $.ajax({
      url:'/delete_address' + addressId,
      method: 'GET',
      success: ((response)=>{
        if(response === 'true'){
          Toastify({
          text: response.message,
          duration: 4000,
          backgroundColor: 'green',
          destination: '/user/profile',
          close: true,
        }).showToast();
      }
      }),

      error: ((error)=>{
        Toastify({
          text: 'Error deleting address',
          duration: 3000,
          backgroundColor: 'red',
          close: true,
        }).showToast();
      })
    });
  });


</script> -->
      

<%- include('../layouts/userFooter.ejs') -%>